<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Checkout | Next Info Systems</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <link href="img/favicon.ico" rel="icon" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Rubik:wght@400,500,600,700&display=swap" rel="stylesheet" />
  <!-- Icon Fonts -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Libraries Stylesheet -->
  <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
  <link href="lib/animate/animate.min.css" rel="stylesheet" />
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <!-- Custom Theme CSS -->
  <link href="css/style.css" rel="stylesheet" />

  <style>
    html, body { height: 100%; }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f3f6fa;
    }
    .checkout-wrapper { flex: 1 0 auto; }
    .checkout-main {
      display: grid;
      grid-template-columns: minmax(0, 530px) 32px minmax(0, 360px);
      gap: 0;
      justify-content: center;
      align-items: flex-start;
      padding: 56px 0 60px 0;
      position: relative;
    }
    @media (max-width: 1100px) {
      .checkout-main { grid-template-columns: 1fr; grid-template-rows: 1fr 52px auto; }
    }
    @media (max-width: 991px) {
      .checkout-main { padding:20px 0 32px 0; }
    }
    .checkout-card, .cart-summary {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 32px 6px rgba(20,30,80,0.11), 0 1.5px 8px rgba(20,20,32,0.08);
      transition: box-shadow 0.25s, transform 0.18s;
    }
    .checkout-card {
      margin: 0; padding: 42px 36px 32px; position: relative; z-index: 2;
      border:1px solid #eceffd;
      animation: flyIn .7s cubic-bezier(.65,1.5,.2,1) both;
    }
    @keyframes flyIn {
      from {transform: translateY(16px) scale(.99);opacity:0;}
      to {transform: translateY(0) scale(1);opacity:1;}
    }
    .checkout-card:focus-within, .checkout-card:hover {
      box-shadow: 0 8px 48px 12px rgba(6,163,218,0.18), 0 1.5px 14px rgba(30,42,120,0.11);
      transform: scale(1.007);
    }
    .checkout-form-title {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--primary,#06A3DA);
      margin-bottom: 1.7rem;
      letter-spacing: 0.03em;
    }
    .form-floating>label {
      color: #045;
      font-size: 1.01rem;
      font-weight: 700;
      letter-spacing: .01rem;
    }
    .form-control:focus { border-color: #06a2da; box-shadow:0 0 0 2px #b6e4fa52; }
    .form-control.is-invalid, .form-control:invalid {
      border-color: #e93332 !important;
      box-shadow: 0 0 0 1px #e9333250;
    }
    .invalid-feedback {
      color: #e93332;
      font-weight: 600;
      font-size: .99em;
    }
    .checkout-form-title + .form-floating { margin-top: -8px;}
    #submit-btn:disabled { opacity:.65; pointer-events:none; }
    .spinner-border { width: 1rem; height:1rem; vertical-align: text-bottom; margin-left:0.5em; }
    .checkout-confirm-msg {
      font-weight:700;margin-top:18px;font-size:1.09em; color:#114a0b; display:none;
    }
    .checkout-error-msg {
      font-weight:700;margin-top:18px;font-size:1.09em; color:#a90019; display:none;
    }

    /* Accent divider */
    .checkout-divider { display:block; }
    .checkout-divider .accent {width:7px;background:linear-gradient(180deg,#06A3DA 60%,#fff0);border-radius:6px;margin:auto;height:320px;}
    @media (max-width:991px) {
      .checkout-main { grid-template-columns:1fr; }
      .checkout-card, .cart-summary { max-width: 100vw; }
      .checkout-divider { display:none; }
    }

    .cart-summary {
      padding: 36px 24px 32px;
      border-left: 3.5px solid var(--primary, #06A3DA);
      max-width: 360px; min-width:240px; margin-left:0;
      transition: border 0.1s;
    }
    .cart-summary h5 { font-size:1.19rem;color:var(--primary,#06A3DA);font-weight:800; letter-spacing:.02em;}
    #checkout-cart-items .cart-product-row {
      display: flex;
      align-items: center;
      gap: 14px;
      border-bottom: 1px solid #f1f1f1;
      padding: 15px 0 15px;
    }
    #checkout-cart-items .cart-product-row:last-child { border-bottom: none; }
    #checkout-cart-items img {
      width: 48px; height: 48px;
      object-fit: cover;
      border-radius: 8px;
      border: 1.5px solid #f0f0f0;
      background: #f7fafd;
    }
    #checkout-cart-items .cart-info strong {
      display: block; font-weight:700; margin-bottom:2px;
      font-size:1.11em;
    }
    #checkout-cart-items .cart-info .desc {
      font-size: 0.97em; color: #4a4c55;margin-bottom:2px;
    }
    #checkout-cart-items .cart-info .qty {
      font-size: 1.03em; color: #065ba6; font-weight: 600;
    }
    #checkout-cart-items .cart-price {
      font-weight: 700;
      color: #0b7db9;
      min-width: 72px;text-align:center;
    }
    #checkout-cart-items .empty {
      padding: 30px 12px 23px;
      text-align: center;
      background: #f6fafc;
      border-radius: 10px;
      color: #ce3731; font-weight: 700;
      margin-bottom: 20px;
      margin-top: 20px;
      font-size:1.07em;
    }
    .cart-summary .total-row {
      font-weight: 900;font-size:1.11rem;color:#054d7b;border-top:2px solid #bbe3f6;
      margin-top: 18px;padding-top: 9px;display:flex;justify-content:space-between;
    }
    .cart-summary .total-label {letter-spacing: .035em;}
    .cart-summary .total-value {color: #1dbb80;}
    .cart-summary .empty-cart-feedback {margin: 1.9em 0 0;padding:.8em 0 .2em;}
    /* Responsive cleanup for spacing */
    @media (max-width:600px){
      .checkout-main {padding:0;}
      .cart-summary, .checkout-card {border-radius:11px;}
    }
    /* (Optional) Light dark mode support */
    @media (prefers-color-scheme: dark) {
      body {background:#151d26;}
      .checkout-card,.cart-summary {background:#232e3d;color:#eef4fa;}
      .checkout-card label, .form-control {color:#eef4fa;}
      .checkout-card input,.checkout-card textarea {background:#192334;color:#eef4fa;}
      .cart-summary {border-left-color:#0fc;}
    }
  </style>
</head>
<body>
  <!-- Topbar Start (unchanged) -->
  <!-- ... topbar & navbar as before ... -->
  <div class="container-fluid bg-dark px-5 d-none d-lg-block">
    <div class="row gx-0">
      <div class="col-lg-8 text-center text-lg-start mb-2 mb-lg-0">
        <div class="d-inline-flex align-items-center" style="height: 45px;">
          <small class="me-3 text-light"><i class="fa fa-map-marker-alt me-2"></i>Dubai Branch Building, Mankhool, Dubai, United Arab Emirates</small>
          <small class="me-3 text-light"><i class="fa fa-phone-alt me-2"></i>+012 345 6789</small>
          <small class="text-light"><i class="fa fa-envelope-open me-2"></i>sales@nextinfosystem.com</small>
        </div>
      </div>
      <div class="col-lg-4 text-center text-lg-end">
        <div class="d-inline-flex align-items-center" style="height: 45px;">
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-twitter fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-facebook-f fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-linkedin-in fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-instagram fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle" href="#"><i class="fab fa-youtube fw-normal"></i></a>
        </div>
      </div>
    </div>
  </div>
  <!-- Navbar (unchanged) -->
  <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top p-0">
    <a href="index.html" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
      <h2 class="m-0 text-primary"><i class="fa fa-laptop me-3"></i>Startup</h2>
    </a>
    <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <div class="navbar-nav ms-auto p-4 p-lg-0">
        <a href="index.html" class="nav-item nav-link">Home</a>
        <a href="about.html" class="nav-item nav-link">About</a>
        <a href="service.html" class="nav-item nav-link">Services</a>
        <a href="product.html" class="nav-item nav-link">Products</a>
        <a href="contact.html" class="nav-item nav-link">Contact</a>
        <a href="checkout.html" class="nav-item nav-link active">Checkout</a>
      </div>
    </div>
  </nav>

  <div class="checkout-wrapper">
    <main class="checkout-main container">
      <!-- Checkout Form Card -->
      <div class="checkout-card" tabindex="0">
        <h2 class="mb-4 text-center text-primary">Checkout</h2>
        <form id="checkout-form" method="POST" action="https://formcarry.com/s/1JWOxOGgO2I" accept-charset="UTF-8" autocomplete="on" novalidate>
          <input type="hidden" name="cart_summary" id="cart_summary" />

          <div class="checkout-form-title mb-4">Contact Information</div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="name" name="user_name" placeholder="Full Name" required autocomplete="name" />
            <label for="name">Full Name</label>
            <div class="invalid-feedback">Please enter your name.</div>
          </div>
          <div class="form-floating mb-3">
            <input type="email" class="form-control" id="email" name="user_email" placeholder="Email Address" required autocomplete="email" />
            <label for="email">Email Address</label>
            <div class="invalid-feedback">Enter a valid email address.</div>
          </div>
          <div class="form-floating mb-3">
            <input type="tel" class="form-control" id="phone" name="user_phone" placeholder="Phone Number" required autocomplete="tel" pattern="^[0-9\-\+\(\)\s]{7,}$"/>
            <label for="phone">Phone Number</label>
            <div class="invalid-feedback">Enter a valid phone number.</div>
          </div>
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="company" name="company" placeholder="Company (optional)" />
            <label for="company">Company (optional)</label>
          </div>
          <div class="form-floating mb-4">
            <textarea class="form-control" id="message" name="message" style="height: 80px;" placeholder="Additional Message"></textarea>
            <label for="message">Additional Message</label>
          </div>
          <button type="submit" class="btn btn-primary w-100 py-2 fw-bold position-relative" id="submit-btn">
            <span id="submit-btn-text">Submit Request</span>
            <span id="submit-btn-spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
          </button>
          <div class="checkout-confirm-msg" id="checkout-confirm-msg"><i class="fa fa-check-circle me-1"></i>Submitted! Thank you.</div>
          <div class="checkout-error-msg" id="checkout-error-msg"><i class="fa fa-times-circle me-1"></i>Submission failed. Please try again.</div>
        </form>
      </div>
      <div class="checkout-divider d-flex align-items-center justify-content-center">
        <div class="accent"></div>
      </div>
      <!-- Cart Preview Summary Card -->
      <aside class="cart-summary" tabindex="0">
        <h5 class="mb-3"><i class="fa fa-shopping-cart me-2"></i>Your Cart</h5>
        <div id="checkout-cart-items"></div>
        <div class="total-row" id="checkout-total-row" style="display:none;">
          <span class="total-label">Total</span>
          <span class="total-value" id="cart-total-amount"></span>
        </div>
        <div class="empty-cart-feedback visually-hidden">No items in your cart.</div>
      </aside>
    </main>
  </div>
  <!-- Footer Start and End (unchanged, keep yours here) -->
  <div class="container-fluid bg-dark text-light mt-5 wow fadeInUp" data-wow-delay="0.1s">
    <div class="container">
      <div class="row gx-5">
        <!-- ... footer cols ... -->
      </div>
    </div>
  </div>
  <div class="container-fluid text-white" style="background: #061429;">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10 text-center py-3">
          <p class="mb-0 small">
            &copy; <span id="year"></span>
            <a class="text-white border-bottom" href="#">nextinfosystem.com</a>. All Rights Reserved.
            Designed by
            <a class="text-white border-bottom" href="https://htmlcodex.com" target="_blank" rel="noopener noreferrer">UMBRA</a>.
            Distributed by
            <a class="text-white border-bottom" href="https://themewagon.com" target="_blank" rel="noopener noreferrer">UMBRA</a>.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
  document.getElementById("year").textContent = new Date().getFullYear();

  function renderCheckoutCart() {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const container = document.getElementById("checkout-cart-items");
    const totalRow = document.getElementById("checkout-total-row");
    const totalAmount = document.getElementById("cart-total-amount");
    let total = 0;
    if (!container) return;

    if (!cart.length) {
      container.innerHTML = '<div class="empty"><i class="fa fa-exclamation-circle me-2"></i>Your cart is empty.</div>';
      if (totalRow) totalRow.style.display = "none";
      document.getElementById('submit-btn').disabled = true;
      document.querySelector(".empty-cart-feedback").classList.remove('visually-hidden');
      return;
    }
    document.querySelector(".empty-cart-feedback").classList.add('visually-hidden');

    // Build cart rows with qty controls and remove button
    let rows = cart.map((item, idx) => {
      let price = item.price ? Number(item.price) : 0;
      total += price * (item.qty || 1);
      return `
        <div class="cart-product-row" data-index="${idx}">
          <img src="${item.img || ''}" alt="${item.name || 'Product'}" />
          <div class="cart-info">
            <strong>${item.name || 'Item'}</strong>
            <div class="desc">${item.desc || ''}</div>
            <div class="qty-controls" style="display:flex; align-items:center; gap:8px; margin-top:6px;">
              <button type="button" class="btn btn-outline-secondary btn-sm qty-decrease" aria-label="Decrease quantity of ${item.name}">&minus;</button>
              <span class="qty-value" style="min-width:28px; text-align:center; font-weight:600;">${item.qty}</span>
              <button type="button" class="btn btn-outline-secondary btn-sm qty-increase" aria-label="Increase quantity of ${item.name}">&plus;</button>
              <button type="button" class="btn btn-outline-danger btn-sm ms-3 remove-item" aria-label="Remove ${item.name}"><i class="fa fa-trash"></i></button>
            </div>
          </div>
          <div class="cart-price">${item.price ? '$' + price.toFixed(2) : ''}</div>
        </div>
      `;
    }).join('');
    container.innerHTML = rows;

    if (totalRow && totalAmount) {
      totalAmount.innerHTML = "$" + total.toFixed(2);
      totalRow.style.display = "";
    }

    // Add event listeners after rendering
    container.querySelectorAll('.qty-increase').forEach(button => {
      button.addEventListener('click', () => {
        let idx = parseInt(button.closest('.cart-product-row').dataset.index);
        cart[idx].qty = (cart[idx].qty || 1) + 1;
        saveCartAndUpdate(cart);
      });
    });
    container.querySelectorAll('.qty-decrease').forEach(button => {
      button.addEventListener('click', () => {
        let idx = parseInt(button.closest('.cart-product-row').dataset.index);
        if (cart[idx].qty > 1) {
          cart[idx].qty -= 1;
          saveCartAndUpdate(cart);
        }
      });
    });
    container.querySelectorAll('.remove-item').forEach(button => {
      button.addEventListener('click', () => {
        let idx = parseInt(button.closest('.cart-product-row').dataset.index);
        cart.splice(idx, 1);
        saveCartAndUpdate(cart);
      });
    });
  }

  function saveCartAndUpdate(cart) {
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCheckoutCart();
  }

  // Generate both plain and HTML cart summary for emails
  function getCartSummary() {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    if (!cart.length) return "Cart is empty.";
    let plain = '', total = 0;
    cart.forEach(item => {
      let price = item.price ? Number(item.price) : 0;
      total += price * (item.qty || 1);
      plain += `- ${item.name || ""}` +
        (item.desc ? ` (${item.desc})` : "") +
        ` | Qty: ${item.qty || 1}` +
        (item.price ? ` | $${price.toFixed(2)}` : "") + "\n";
    });
    plain += `\nORDER TOTAL: $${total.toFixed(2)}\n\n`;
    let table = `<table cellpadding="8" border="1" style="border-collapse:collapse;border:1px solid #ccc;font-family:sans-serif;font-size:15px;width:100%;max-width:540px;">
      <thead><tr style="background:#f8f8f8;"><th>Product</th><th>Description</th><th>Qty</th><th>Price</th></tr></thead><tbody>`;
    cart.forEach(item => {
      let price = item.price ? Number(item.price) : 0;
      table += `<tr>
        <td>${item.name || ""}</td>
        <td>${item.desc || ""}</td>
        <td style="text-align:right;">${item.qty || 1}</td>
        <td style="text-align:right;">${item.price ? "$" + price.toFixed(2) : "-"}</td>
      </tr>`;
    });
    table += `<tr style="background:#f8f8f8;font-weight:700;"><td colspan="3" style="text-align:right;">Total</td><td style="text-align:right;">$${total.toFixed(2)}</td></tr></tbody></table>`;
    return `${plain}\nHTML SUMMARY:\n${table}`;
  }

  document.getElementById('checkout-form').addEventListener('submit', function (e) {
    e.preventDefault();
    let form = this;
    let valid = true;
    ['name','email','phone'].forEach(id=>{
      let input = form.querySelector('#'+id);
      if(!input.checkValidity()) { input.classList.add('is-invalid'); valid=false; }
      else { input.classList.remove('is-invalid'); }
    });
    if(!valid) return;

    document.getElementById('submit-btn').disabled = true;
    document.getElementById('submit-btn-spinner').classList.remove('d-none');
    document.getElementById('submit-btn-text').innerText = "Submitting...";
    document.getElementById('cart_summary').value = getCartSummary();

    fetch(form.action, {
      method: "POST",
      body: new FormData(form),
      headers: { 'Accept': 'application/json' }
    }).then(response => {
      if(response.ok){
        document.getElementById('checkout-confirm-msg').style.display = "block";
        document.getElementById('checkout-error-msg').style.display = "none";
        localStorage.removeItem("cart");
        setTimeout(() => { form.reset(); renderCheckoutCart(); }, 1500);
        document.getElementById('submit-btn').disabled = false;
        document.getElementById('submit-btn-spinner').classList.add('d-none');
        document.getElementById('submit-btn-text').innerText = "Submit Request";
      } else throw new Error();
    }).catch(()=>{
      document.getElementById('checkout-confirm-msg').style.display = "none";
      document.getElementById('checkout-error-msg').style.display = "block";
      document.getElementById('submit-btn').disabled = false;
      document.getElementById('submit-btn-spinner').classList.add('d-none');
      document.getElementById('submit-btn-text').innerText = "Submit Request";
    });
  });

  document.addEventListener('DOMContentLoaded', renderCheckoutCart);
</script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="lib/wow/wow.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/counterup/counterup.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
