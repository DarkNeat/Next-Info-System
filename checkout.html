<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Checkout | Next Info Systems</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <link href="img/favicon.ico" rel="icon" />
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Rubik:wght@400,500,600,700&display=swap" rel="stylesheet" />
  <!-- Icon Fonts -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Libraries Stylesheet -->
  <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
  <link href="lib/animate/animate.min.css" rel="stylesheet" />
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <!-- Template Stylesheet -->
  <link href="css/style.css" rel="stylesheet" />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f8f9fa;
    }

    /* Main container */
    .checkout-wrapper {
      display: flex;
      flex: 1 0 auto;
      justify-content: center;
      align-items: flex-start;
      padding: 48px 0;
      width: 100%;
    }

    .checkout-main {
      display: flex;
      gap: 16px;
      max-width: 900px;
      width: 100%;
      justify-content: center;
      align-items: stretch; /* equal height columns */

      /* Increased height for better fit */
      max-height: 640px;
    }

    @media (max-width: 991px) {
      .checkout-main {
        flex-direction: column;
        gap: 0;
        align-items: center;
        max-height: none;
      }
    }

    .checkout-card, .cart-summary {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 1px 16px 1px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;

      /* Increased height */
      height: 640px;
      overflow: hidden;
    }

    @media (max-width: 991px) {
      .checkout-card, .cart-summary {
        height: auto;
        max-width: 600px;
        width: 100%;
        margin-bottom: 24px;
      }
    }

    .checkout-card {
      max-width: 475px;
      width: 100%;
      padding: 36px 32px 28px;
    }

    .checkout-form-title {
      font-size: 1.3rem;
      font-weight: 800;
      color: #06A3DA;
      margin-bottom: 1.6rem;
      letter-spacing: 0.03em;
    }

    .cart-summary {
      max-width: 350px;
      width: 100%;
      padding: 32px 26px;
      border-left: 4px solid #06A3DA;
      flex-direction: column;
    }

    @media (max-width: 991px) {
      .cart-summary {
        border-left: none;
        border-top: 4px solid #06A3DA;
      }
    }

    #checkout-cart-items {
      flex-grow: 1;
      overflow-y: auto;
      padding-right: 10px;
      scrollbar-width: thin;
    }

    #checkout-cart-items .cart-product-row {
      display: flex;
      align-items: center;
      gap: 14px;
      border-bottom: 1px solid #06A3DA; /* Blue divider */
      padding: 24px 0;
      min-height: 110px; /* fixed row height */
      box-sizing: border-box;
    }

    #checkout-cart-items .cart-product-row:last-child {
      border-bottom: none;
    }

    #checkout-cart-items img {
      width: 54px;
      height: 54px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #eee;
      flex-shrink: 0;
      background: #f7fafd;
    }

    #checkout-cart-items .cart-info {
      flex: 1 1 auto;
    }

    #checkout-cart-items .cart-info strong {
      display: block;
      font-weight: 700;
      margin-bottom: 2px;
      font-size: 1.11em;
    }

    #checkout-cart-items .cart-info .desc {
      font-size: 0.97em;
      color: #555;
      margin-bottom: 6px;
    }

    #checkout-cart-items .cart-info .qty-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #checkout-cart-items .cart-info .qty-controls button {
      width: 26px;
      height: 26px;
      border-radius: 6px;
      padding: 0;
      font-weight: 700;
      font-size: 18px;
      line-height: 1;
      border: 1px solid #06A3DA;
      background: white;
      color: #06A3DA;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      transition: background-color 0.2s ease;
    }

    #checkout-cart-items .cart-info .qty-controls button:hover {
      background-color: #06A3DA;
      color: white;
    }

    #checkout-cart-items .cart-info .remove-item {
      margin-left: 12px;
      border-color: #dc3545;
      color: #dc3545;
    }

    #checkout-cart-items .cart-info .remove-item:hover {
      background-color: #dc3545;
      color: white;
    }

    #checkout-cart-items .cart-price {
      text-align: right;
      font-weight: bold;
      color: #06A3DA;
      min-width: 70px;
    }

    #checkout-cart-items .empty {
      padding: 28px;
      text-align: center;
      background: #fff0f0;
      border-radius: 10px;
      color: #c43c38;
      font-weight: 700;
      margin-bottom: 24px;
      margin-top: 24px;
      font-size: 1.07em;
    }
  </style>
</head>
<body>

  <!-- Topbar Start -->
  <div class="container-fluid bg-dark px-5 d-none d-lg-block">
    <div class="row gx-0">
      <div class="col-lg-8 text-center text-lg-start mb-2 mb-lg-0">
        <div class="d-inline-flex align-items-center" style="height: 45px;">
          <small class="me-3 text-light"><i class="fa fa-map-marker-alt me-2"></i>Dubai Branch Building, Mankhool, Dubai, United Arab Emirates</small>
          <small class="me-3 text-light"><i class="fa fa-phone-alt me-2"></i>+012 345 6789</small>
          <small class="text-light"><i class="fa fa-envelope-open me-2"></i>sales@nextinfosystem.com</small>
        </div>
      </div>
      <div class="col-lg-4 text-center text-lg-end">
        <div class="d-inline-flex align-items-center" style="height: 45px;">
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-twitter fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-facebook-f fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-linkedin-in fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle me-2" href="#"><i class="fab fa-instagram fw-normal"></i></a>
          <a class="btn btn-sm btn-outline-light btn-sm-square rounded-circle" href="#"><i class="fab fa-youtube fw-normal"></i></a>
        </div>
      </div>
    </div>
  </div>
  <!-- Topbar End -->

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top p-0">
    <a href="index.html" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
      <h2 class="m-0 text-primary"><i class="fa fa-laptop me-3"></i>Startup</h2>
    </a>
    <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <div class="navbar-nav ms-auto p-4 p-lg-0">
        <a href="index.html" class="nav-item nav-link">Home</a>
        <a href="about.html" class="nav-item nav-link">About</a>
        <a href="service.html" class="nav-item nav-link">Services</a>
        <a href="product.html" class="nav-item nav-link">Products</a>
        <a href="contact.html" class="nav-item nav-link">Contact</a>
        <a href="checkout.html" class="nav-item nav-link active">Checkout</a>
      </div>
    </div>
  </nav>

  <div class="checkout-wrapper">
    <div class="checkout-main">

      <!-- Checkout Form Card -->
      <div class="checkout-card">
        <h2 class="mb-4 text-center text-primary">Checkout</h2>
        <form id="checkout-form" method="POST" action="https://formcarry.com/s/1JWOxOGgO2I" accept-charset="UTF-8" autocomplete="on">
          <input type="hidden" name="cart_summary" id="cart_summary" />

          <div class="checkout-form-title mb-4">Contact Information</div>

          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="name" name="user_name" placeholder="Full Name" required autocomplete="name" />
            <label for="name">Full Name</label>
          </div>

          <div class="form-floating mb-3">
            <input type="email" class="form-control" id="email" name="user_email" placeholder="Email Address" required autocomplete="email" />
            <label for="email">Email Address</label>
          </div>

          <div class="form-floating mb-3">
            <input type="tel" class="form-control" id="phone" name="user_phone" placeholder="Phone Number" required autocomplete="tel" />
            <label for="phone">Phone Number</label>
          </div>

          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="company" name="company" placeholder="Company (optional)" />
            <label for="company">Company (optional)</label>
          </div>

          <div class="form-floating mb-4">
            <textarea class="form-control" id="message" name="message" style="height: 80px;" placeholder="Additional Message"></textarea>
            <label for="message">Additional Message</label>
          </div>

          <button type="submit" class="btn btn-primary w-100 py-2 fw-bold position-relative" id="submit-btn">
            <span id="submit-btn-text">Submit Request</span>
            <span id="submit-btn-spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
          </button>
        </form>
      </div>

      <!-- Cart Summary Card -->
      <aside class="cart-summary">
        <h5 class="mb-3"><i class="fa fa-shopping-cart me-2"></i>Your Cart</h5>
        <div id="checkout-cart-items"></div>
      </aside>

    </div>
  </div>

  <!-- Footer Start -->
  <div class="container-fluid text-white" style="background: #061429;">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10 text-center py-3">
          <p class="mb-0 small">
            &copy; <span id="year"></span>
            <a class="text-white border-bottom" href="#">nextinfosystem.com</a>. All Rights Reserved.
            Designed by
            <a class="text-white border-bottom" href="https://htmlcodex.com" target="_blank" rel="noopener noreferrer">UMBRA</a>.
            Distributed by
            <a class="text-white border-bottom" href="https://themewagon.com" target="_blank" rel="noopener noreferrer">UMBRA</a>.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    function renderCheckoutCart() {
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const container = document.getElementById("checkout-cart-items");
      if (!container) return;

      if (!cart.length) {
        container.innerHTML = '<div class="empty"><i class="fa fa-exclamation-circle me-2"></i>Your cart is empty.</div>';
        document.getElementById('submit-btn').disabled = true;
        return;
      }

      document.getElementById('submit-btn').disabled = false;

      let rows = cart.map((item, idx) => {
        let price = item.price ? Number(item.price) : 0;
        return `
          <div class="cart-product-row" data-index="${idx}">
            <img src="${item.img || ''}" alt="${item.name || 'Product'}" />
            <div class="cart-info">
              <strong>${item.name}</strong>
              <div class="desc">${item.desc || ''}</div>
              <div class="qty-controls" style="display:flex; align-items:center; gap:6px; margin-top:6px;">
                <button type="button" class="btn btn-outline-secondary btn-sm qty-decrease" aria-label="Decrease quantity of ${item.name}">&minus;</button>
                <span class="qty-value" style="min-width:28px; text-align:center; font-weight:600;">${item.qty}</span>
                <button type="button" class="btn btn-outline-secondary btn-sm qty-increase" aria-label="Increase quantity of ${item.name}">&plus;</button>
                <button type="button" class="btn btn-outline-danger btn-sm ms-3 remove-item" aria-label="Remove ${item.name}"><i class="fa fa-trash"></i></button>
              </div>
            </div>
            <div class="cart-price">${item.price ? '$' + price.toFixed(2) : ''}</div>
          </div>
        `;
      }).join('');
      container.innerHTML = rows;

      // Add quantity and remove item event listeners
      container.querySelectorAll('.qty-increase').forEach(button => {
        button.addEventListener('click', () => {
          let idx = parseInt(button.closest('.cart-product-row').dataset.index);
          cart[idx].qty = (cart[idx].qty || 1) + 1;
          saveCartAndUpdate(cart);
        });
      });
      container.querySelectorAll('.qty-decrease').forEach(button => {
        button.addEventListener('click', () => {
          let idx = parseInt(button.closest('.cart-product-row').dataset.index);
          if (cart[idx].qty > 1) {
            cart[idx].qty -= 1;
            saveCartAndUpdate(cart);
          }
        });
      });
      container.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', () => {
          let idx = parseInt(button.closest('.cart-product-row').dataset.index);
          cart.splice(idx, 1);
          saveCartAndUpdate(cart);
        });
      });
    }

    function saveCartAndUpdate(cart) {
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCheckoutCart();
    }

    function getCartSummary() {
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");
      if (!cart.length) return "Cart is empty.";
      let plain = '', total = 0;
      cart.forEach(item => {
        let price = item.price ? Number(item.price) : 0;
        total += price * (item.qty || 1);
        plain += `- ${item.name || ""}` +
          (item.desc ? ` (${item.desc})` : "") +
          ` | Qty: ${item.qty || 1}` +
          (item.price ? ` | $${price.toFixed(2)}` : "") + "\n";
      });
      plain += `\nORDER TOTAL: $${total.toFixed(2)}\n\n`;
      let table = `<table cellpadding="8" border="1" style="border-collapse:collapse;border:1px solid #ccc;font-family:sans-serif;font-size:15px;width:100%;max-width:540px;">
        <thead><tr style="background:#f8f8f8;"><th>Product</th><th>Description</th><th>Qty</th><th>Price</th></tr></thead><tbody>`;
      cart.forEach(item => {
        let price = item.price ? Number(item.price) : 0;
        table += `<tr>
          <td>${item.name || ""}</td>
          <td>${item.desc || ""}</td>
          <td style="text-align:right;">${item.qty || 1}</td>
          <td style="text-align:right;">${item.price ? "$" + price.toFixed(2) : "-"}</td>
        </tr>`;
      });
      table += `<tr style="background:#f8f8f8;font-weight:700;"><td colspan="3" style="text-align:right;">Total</td><td style="text-align:right;">$${total.toFixed(2)}</td></tr></tbody></table>`;
      return `${plain}\nHTML SUMMARY:\n${table}`;
    }

    document.getElementById('checkout-form').addEventListener('submit', function (e) {
      e.preventDefault();
      let form = this;
      let valid = true;
      ['name','email','phone'].forEach(id=>{
        let input = form.querySelector('#'+id);
        if(!input.checkValidity()) { input.classList.add('is-invalid'); valid=false; }
        else { input.classList.remove('is-invalid'); }
      });
      if(!valid) return;

      document.getElementById('submit-btn').disabled = true;
      document.getElementById('submit-btn-spinner').classList.remove('d-none');
      document.getElementById('submit-btn-text').innerText = "Submitting...";
      document.getElementById('cart_summary').value = getCartSummary();

      fetch(form.action, {
        method: "POST",
        body: new FormData(form),
        headers: { 'Accept': 'application/json' }
      }).then(response => {
        document.getElementById('submit-btn').disabled = false;
        document.getElementById('submit-btn-spinner').classList.add('d-none');
        document.getElementById('submit-btn-text').innerText = "Submit Request";
        if(response.ok){
          localStorage.removeItem("cart");
          setTimeout(() => { form.reset(); renderCheckoutCart(); }, 1500);
        }
      }).catch(() => {
        document.getElementById('submit-btn').disabled = false;
        document.getElementById('submit-btn-spinner').classList.add('d-none');
        document.getElementById('submit-btn-text').innerText = "Submit Request";
      });
    });

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", renderCheckoutCart);
    } else {
      renderCheckoutCart();
    }
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="lib/wow/wow.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/counterup/counterup.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
